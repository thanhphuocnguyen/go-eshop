version: "2"
sql:
  - engine: "postgresql"
    queries: "./internal/db/query"
    schema: "./migrations"
    database:
      uri: "postgresql://postgres:postgres@localhost:5433/eshop?sslmode=disable"
    rules:
      - sqlc/db-prepare
    gen:
      go:
        package: "repository"
        out: "./internal/db/repository"
        sql_package: "pgx/v5"
        overrides:
        - db_type: "uuid"
          go_type:
            import: "github.com/google/uuid"
            type: "UUID"
        - db_type: "timestamptz"
          go_type:
            type: "time.Time"
        - column: "order_items.attributes_snapshot"
          go_type:
            type: "AttributeDataSnapshot"
        - column: "orders.shipping_address"
          go_type:
            type: "ShippingAddressSnapshot"
        emit_interface: true
        emit_json_tags: true
        emit_empty_slices: true
        emit_pointers_for_null_types: true
rules:
- name: no-pg
  message: "invalid engine: postgresql"
  rule: |
    config.engine == "postgresql"
- name: no-delete
  message: "don't use delete statements"
  rule: |
    query.sql.contains("DELETE")
- name: only-one-param
  message: "too many parameters"
  rule: |
    query.params.size() > 1
- name: no-exec
  message: "don't use exec"
  rule: |
    query.cmd == "exec"